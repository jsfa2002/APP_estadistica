# -*- coding: utf-8 -*-
"""app3

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/19ypVmeuLg4oZ8maZp-MtDLDaJmcBfGHv
"""
import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LinearRegression, LogisticRegression
from sklearn.discriminant_analysis import LinearDiscriminantAnalysis, QuadraticDiscriminantAnalysis
from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score, confusion_matrix, classification_report
from sklearn.impute import SimpleImputer
from sklearn.decomposition import PCA
from prince import MCA

# Configuraci贸n de la p谩gina
st.set_page_config(page_title="ReDim - An谩lisis de Datos", layout="wide")
st.title(' ReDim: Exploraci贸n de Datos con PCA, MCA y Modelos de Predicci贸n')

# Sidebar para subir el archivo
st.sidebar.header("Opciones")
uploaded_file = st.sidebar.file_uploader("Sube tu archivo CSV", type=["csv"])

if uploaded_file is not None:
    df = pd.read_csv(uploaded_file)
    st.sidebar.success("Archivo cargado exitosamente!")
    st.subheader(" Vista previa de los datos")
    st.dataframe(df.head())
    
    numeric_cols = df.select_dtypes(include=['float64', 'int64']).columns
    cat_cols = df.select_dtypes(include=['object']).columns

    # An谩lisis Exploratorio de Datos (EDA)
    if st.sidebar.button("Ejecutar EDA"):
        st.subheader(" An谩lisis Exploratorio de Datos (EDA)")
        st.write("### Estad铆sticas descriptivas")
        st.write(df.describe())
        st.write("### Valores nulos por columna")
        st.bar_chart(df.isnull().sum())

    # PCA
    if st.sidebar.button("Ejecutar PCA"):
        st.subheader(" An谩lisis de Componentes Principales (PCA)")
        if len(numeric_cols) > 1:
            imputer = SimpleImputer(strategy='mean')
            df_filled = pd.DataFrame(imputer.fit_transform(df[numeric_cols]), columns=numeric_cols)
            scaler = StandardScaler()
            df_scaled = scaler.fit_transform(df_filled)
            pca = PCA()
            pca.fit(df_scaled)
            st.bar_chart(pca.explained_variance_ratio_)
        else:
            st.error("Se necesitan al menos 2 variables num茅ricas para ejecutar PCA")
    
    # MCA
    if st.sidebar.button("Ejecutar MCA"):
        st.subheader(" An谩lisis de Correspondencias M煤ltiples (MCA)")
        if len(cat_cols) > 1:
            df_cat = df[cat_cols].astype(str)
            mca = MCA()
            mca.fit(df_cat)
            st.bar_chart(mca.eigenvalues_)
        else:
            st.warning("Se necesitan al menos dos columnas categ贸ricas para ejecutar MCA.")

    # Modelos de Regresi贸n y Predicci贸n
    st.sidebar.subheader("Modelos de Predicci贸n")
    model_option = st.sidebar.selectbox("Selecciona un modelo", ["Regresi贸n Lineal", "Regresi贸n Log铆stica", "LDA", "QDA"])
    target_col = st.sidebar.selectbox("Selecciona la variable objetivo", df.columns)
    feature_cols = st.sidebar.multiselect("Selecciona las variables regresoras", df.columns.drop(target_col))
    
    if st.sidebar.button("Ejecutar Modelo"):
        X = df[feature_cols]
        y = df[target_col]
        
        # Divisi贸n de datos
        X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)
        st.write(f"Datos de entrenamiento: {X_train.shape[0]} filas")
        st.write(f"Datos de prueba: {X_test.shape[0]} filas")
        
        # Selecci贸n del modelo
        if model_option == "Regresi贸n Lineal":
            model = LinearRegression()
        elif model_option == "Regresi贸n Log铆stica":
            model = LogisticRegression()
        elif model_option == "LDA":
            model = LinearDiscriminantAnalysis()
        else:
            model = QuadraticDiscriminantAnalysis()
        
        model.fit(X_train, y_train)
        y_pred = model.predict(X_test)
        
        # Evaluaci贸n del modelo
        accuracy = accuracy_score(y_test, y_pred.round())
        precision = precision_score(y_test, y_pred.round(), average='weighted', zero_division=0)
        recall = recall_score(y_test, y_pred.round(), average='weighted', zero_division=0)
        f1 = f1_score(y_test, y_pred.round(), average='weighted', zero_division=0)
        
        # Matriz de confusi贸n
        cm = confusion_matrix(y_test, y_pred.round())
        st.write("### Matriz de Confusi贸n")
        st.write(cm)
        
        # M茅tricas en tabla
        results_df = pd.DataFrame({
            "Modelo": [model_option],
            "Accuracy": [accuracy],
            "Precision": [precision],
            "Recall": [recall],
            "F1-Score": [f1]
        })
        st.write("### M茅tricas del Modelo")
        st.dataframe(results_df)
    
    # Comparaci贸n de Modelos
    if st.sidebar.button("Comparaci贸n de Modelos"):
        st.subheader(" Comparaci贸n de Modelos")
        st.write("Se comparar谩n las m茅tricas de los modelos ejecutados previamente.")
        # Aqu铆 se pueden agregar m谩s modelos y comparar sus m茅tricas

st.sidebar.markdown("---")
st.sidebar.markdown(" Desarrollado con cari帽o por ReDim Team")

